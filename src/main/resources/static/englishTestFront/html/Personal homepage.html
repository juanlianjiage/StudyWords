<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <title>页面</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            min-height: 100vh; /* 设置页面最小高度为视口的100% */
            display: flex;
            flex-direction: column; /* 设置主轴方向为纵向，使得内容能够垂直自动扩展 */
        }

        /* 顶部盒子样式 */
        #top-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #333;
            color: #fff;
            padding: 20px;

        }

        #user-info {
            display: flex;
            align-items: center;
        }

        #user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            overflow: hidden;
            margin-right: 10px;
            position: relative;
            cursor: pointer; /* 添加鼠标指针样式 */
        }

        #user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* 底部盒子样式 */
        #bottom-container {
            /* 底部盒子样式 */
            flex: 1; /* 使底部盒子占据剩余空间 */
            display: flex;
            flex-direction: row; /* 设置底部盒子的主轴方向为横向 */
        }

        #left-box {
            flex: 1; /* 占比1 */
            background-color: #eee;
            padding: 20px;
            display: flex;
            flex-direction: column;
            cursor: pointer;
        }

        .menu-item {
            margin-bottom: 10px;
            padding: 10px;
            background-color: #ccc;
            border-radius: 5px;
            cursor: pointer;
        }

        #right-box {
            flex: 4; /* 占比4 */
            background-color: #ddd;
            padding: 20px;
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .grid-item {
            background-color: #ccc;
            padding: 20px;
            border-radius: 5px;
            text-align: center;
        }
        .word-list {
            margin-top: 10px;
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 5px;
        }

        .word-item {
            margin-bottom: 10px;
            padding: 10px;
            background-color: #f5f5f5;
            border-radius: 5px;
        }
        .collapse-button {
            /* 与详情按钮相同的样式 */
            margin-top: 10px;
            margin-left: 10px;
            cursor: pointer;
            background-color: #ccc;
            padding: 10px;
            border-radius: 5px;
            display: inline-block;
        }

    </style>
</head>
<body>
<div id="top-container">
    <div id="current-time">12:00 PM</div>
    <div id="user-info">
        <div >用户名：</div>
        <div id="username"></div>
        <div>
            <button id="logout" onclick="logout()">退出</button>
        </div>
    </div>
</div>
<div id="bottom-container">
    <div id="left-box">
        <!-- 左侧盒子，占比1 -->
        <div class="menu-item" onclick="showMyCourses()">我的课程</div>
        <div class="menu-item" onclick="studyWords()">learn</div>
        <div class="menu-item" onclick="shouldReviewWords()">review</div>
        <div class="menu-item" onclick="showSelfTestScore()">测试成绩</div>
        <div class="menu-item" onclick="showMyTests()">学习单词记录</div>
        <div class="menu-item" onclick="showUnfamiliarWords()">生词集</div>


    </div>
    <div id="right-box">
        <!-- 右侧盒子，占比4 -->
        <h2 id="content-title">欢迎！</h2>
        <div id="my-courses" style="display: none;">
            <!-- 我的课程内容 -->
            <div class="grid-container">
                <div class="grid-item">课程1</div>
                <div class="grid-item">课程2</div>
                <div class="grid-item">课程3</div>
                <div class="grid-item">课程4</div>
                <div class="grid-item">课程5</div>
                <div class="grid-item">课程6</div>
            </div>
        </div>
        <div id="my-tests" style="display: none;">
            <!-- 我的测试内容 -->
            <div class="grid-container">
                <div class="grid-item"></div>
                <div class="grid-item"></div>
                <div class="grid-item"></div>
                <div class="grid-item"></div>
                <div class="grid-item"></div>
                <div class="grid-item"></div>
            </div>
        </div>

    </div>
</div>
<script>
    var unkownWords=[]
    var selfTest=[]
    document.getElementById('username').innerHTML=sessionStorage.getItem("username")
    function showMyCourses() {
        document.getElementById('content-title').innerText = '我的课程';
        document.getElementById('my-courses').style.display = 'block';
        document.getElementById('my-tests').style.display = 'none';
    }
    function studyWords()
    {
        window.location.href="main.html"
    }
    function showMyCourses() {
        const rightBox = document.getElementById('right-box');
        rightBox.innerHTML = ''; // 清空右侧盒子内容

        // "我的课程"内容
        const myCoursesContent = document.createElement('div');
        myCoursesContent.id = 'my-courses';
        myCoursesContent.innerHTML = `
                <!-- 我的课程内容 -->
        <div class="grid-container">
        <div class="grid-item">课程1</div>
        <div class="grid-item">课程2</div>
        <div class="grid-item">课程3</div>
        <div class="grid-item">课程4</div>
        <div class="grid-item">课程5</div>
        <div class="grid-item">课程6</div>
        </div>
        `;

        // 将"我的课程"内容添加到右侧盒子
        rightBox.appendChild(myCoursesContent);
    }

    //获取用户生词集
    function showUnfamiliarWords() {
        $.ajax({
            url: '/studentFunction/unkonwlist',
            method: 'post',
            dataType: 'json',
            success: function (response) {
                if (response.success) {
                    unkownWords = response.data;
                    displayUnfamiliarWords(); // 调用显示生词的函数
                }
            }
        }).then(result => {
            console.log(result.data)
        })
    }
    function shouldReviewWords() {
        $.ajax({
            url: '/studentFunction/reviewWords',
            method: 'post',
            dataType: 'json',
            success: function (response) {
                if (response.success) {
                  alert(response.data)
                }
            }
        }).then(result => {
            console.log(result.data)
        })
    }
    function displayUnfamiliarWords() {
        const rightBox = document.getElementById('right-box');
        rightBox.innerHTML = ''; // 清空右侧盒子内容

        const title = document.createElement('h2');
        title.innerText = '生词集';
        rightBox.appendChild(title);

        // 按等级分类
        const levels = {};

        // 遍历生词列表并按等级分类
        unkownWords.forEach(wordData => {
            const wordLevel = wordData.wordLevel;

            if (!levels[wordLevel]) {
                levels[wordLevel] = [];
            }

            levels[wordLevel].push(wordData);
        });

        // 显示分类后的生词
        for (const level in levels) {
            if (levels.hasOwnProperty(level)) {
                // 显示等级和总数的盒子
                const levelSummary = document.createElement('div');
                levelSummary.classList.add('level-summary');
                levelSummary.innerHTML = `
                        <p><strong>等级:</strong> ${level}</p>
                        <p><strong>总数:</strong> ${levels[level].length}</p>
                        <button onclick="showWordDetails('${level}')">详情</button>
                    `;
                rightBox.appendChild(levelSummary);

                // 创建单词列表的盒子，初始时不显示
                const wordListContainer = document.createElement('div');
                wordListContainer.id = `wordList_${level}`;
                wordListContainer.classList.add('word-list');
                wordListContainer.style.display = 'none';
                rightBox.appendChild(wordListContainer);
            }
        }
    }

    // 点击详情按钮显示单词列表
    function showWordDetails(level) {
        const wordListContainer = document.getElementById(`wordList_${level}`);
        wordListContainer.innerHTML = ''; // 清空单词列表

        const words = unkownWords.filter(wordData => wordData.wordLevel === level);

        words.forEach(wordData => {
            const wordElement = document.createElement('div');
            wordElement.classList.add('word-item');
            wordElement.innerHTML = `
                    <p><strong>单词:</strong> ${wordData.wordSpell}</p >
                    <p><strong>释义:</strong> ${wordData.wordMeaning}</p >
                    <p><strong>音标:</strong> ${wordData.wordPhonetic}</p >
                `;
            wordListContainer.appendChild(wordElement);
        });

        // 检查是否已经存在"收起"按钮
        if (!document.querySelector(`#right-box .collapse-button`)) {
            // 添加"收起"按钮
            const collapseButton = document.createElement('div');
            collapseButton.classList.add('collapse-button');
            collapseButton.innerText = '收起';
            collapseButton.addEventListener('click', function () {
                // 点击"收起"按钮时隐藏单词列表
                wordListContainer.style.display = 'none';
            });

            // 获取详情按钮
            const detailsButton = document.querySelector(`#right-box .level-summary button`);

            // 收起按钮在详情按钮右侧
            detailsButton.parentNode.insertBefore(collapseButton, detailsButton.nextSibling);
        }

        // 显示单词列表
        wordListContainer.style.display = 'block';
    }

    function showSelfTestScore() {
        $.ajax({
            url: '/studentFunction/self_Test',
            method: 'post',
            dataType: 'json',
            success: function (response) {
                if (response.success) {
                    selfTest = response.data;
                    displayTestScores(); // 调用显示测试成绩的函数
                }
            }
        });
    }

    function displayTestScores() {
        const rightBox = document.getElementById('right-box');
        rightBox.innerHTML = ''; // 清空右侧盒子内容

        const title = document.createElement('h2');
        title.innerText = '测试成绩';
        rightBox.appendChild(title);

        const scoresContainer = document.createElement('div');
        scoresContainer.classList.add('grid-container');

        // 按时间降序排序测试成绩
        selfTest.sort((a, b) => new Date(b.time) - new Date(a.time));

        // 显示每次测试成绩
        selfTest.forEach(testData => {
            const scoreElement = document.createElement('div');
            scoreElement.classList.add('grid-item');
            scoreElement.innerHTML = `
            <p><strong>学生ID:</strong> ${testData.studentId}</p >
            <p><strong>时间:</strong> ${testData.time}</p >
            <p><strong>成绩:</strong> ${testData.score}</p >
            <p><strong>词汇:</strong> ${testData.vocabulary}</p >
        `;
            scoresContainer.appendChild(scoreElement);
        });

        rightBox.appendChild(scoresContainer);
    }

    function showMyTests() {
        document.getElementById('content-title').innerText = '背单词';
        document.getElementById('my-courses').style.display = 'none';
        document.getElementById('my-tests').style.display = 'block';
        // window.location.href='main.html'
    }

    function changeAvatar() {
        // 创建一个文件输入框
        const fileInput = document.createElement('input');
        fileInput.type = 'file';
        fileInput.accept = 'image/*';
        fileInput.addEventListener('change', handleFileSelect);
        fileInput.click();

        function handleFileSelect(event) {
            const file = event.target.files[0];
            // 将图片显示在图像框里
            const image = document.createElement('img');
            image.src = URL.createObjectURL(file);
            document.getElementById('user-avatar').innerHTML = '';
            document.getElementById('user-avatar').appendChild(image);
            const formData = new FormData();
            formData.append('avatar', file);

            // 发送至后端
            fetch('/', {
                method: 'POST',
                body: formData,
            })
                .then(response => response.json())
                .then(data => {
                    // 处理上传成功的逻辑
                    console.log('上传成功:', data);
                })
                .catch(error => {
                    // 处理上传失败的逻辑
                    console.error('上传失败:', error);
                });
        }
    }

    // 获取实时时间并更新
    function updateTime() {
        const currentTimeElement = document.getElementById('current-time');
        const currentTime = new Date().toLocaleTimeString();
        currentTimeElement.textContent = currentTime;
    }

    // 更新时间间隔，这里设置为每秒更新一次
    setInterval(updateTime, 1000);
    // 初始加载时间
    updateTime();
    //退出登录，清除session，成功并返回登陆页面
    function logout()
    {
        $.ajax({
            url:'/student_login/login_out',
            method: 'GET',
            dataType:'JSON',
            success:function (response)
            {
                if (response.success)
                {
                    sessionStorage.removeItem("username");
                    alert(response.data)
                    window.location.href="login.html"
                }
            },
            error:function (){
                alert("错误！")
                sessionStorage.removeItem("username");
                window.location.href="login.html"
            }
        });
    }
</script>
</body>
</html>
